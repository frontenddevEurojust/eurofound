!function(t){Drupal.behaviors.popup={attach:function(e){t("#popup-active-overlay").length||t("body").append('<div id="popup-active-overlay"></div>'),t(".popup-menu-flat:not(.popup-menu-flat-processed)").each(function(){var e=t(this);e.addClass("popup-menu-flat-processed"),new PopupMenuContainerElement(e)}),t(".popup-element:not(.popup-element-processed)").each(function(){var e=t(this);e.addClass("popup-element-processed").removeClass("popup-element-noscript"),new PopupElement(e)}),t(".popup-menu-leaf-title:not(.popup-menu-leaf-processed)").each(function(){var e=t(this);e.addClass("popup-menu-leaf-processed"),new PopupMenuLeafElement(e)}),t("a[href^='/ahah/popup/view']",e).each(function(){var i=t(this),p=t(i.parents("div.inner").get(0)),n=function(t){p.html(t),Drupal.attachBehaviors(e)},o=function(){return t.get(i.attr("href"),null,n),!1};i.click(o)}),t(".ajax form").each(function(){var e=t(this);e.attr("action").match(/^\/ahah\/popup/)&&e.attr("action","")});var i=function(){t(".popup-element").trigger("reposition")};t(window).unbind("resize",i).resize(i)}},PopupElement=function(e){var i=this;this.element=e,this.title=t(t(".popup-element-title",this.element)[0]),this.body=t(t(".popup-element-body",this.element)[0]),this.elementId=this.element.attr("id"),this.closeButton=t(".popup-close",this.body),this.children=new Array,this.isRoot=0==this.title.parents(".popup-element-body,.popup-menu-flat").length,this.body.data("popupElement",this),PopupElement.assignEffects.apply(this),PopupElement.assignPositioning.apply(this),PopupElement.dom.apply(this),PopupElement.assignExpansion.apply(this),PopupElement.assignEvents.apply(this),PopupElement.applyAttributes.apply(this),PopupElement.applyAJAX.apply(this),this.element.bind("reposition",function(){i.position()}),this.closeButton.click(function(){return PopupElement.hide.apply(i),!1})},PopupMenuLeafElement=function(t){this.element=t,this.parent=this.element.parents(".popup-element-body,.popup-menu-flat").data("popupElement");var e=this;this.element.mouseover(function(){if(e.parent)for(var t in e.parent.children)PopupElement.hide.apply(e.parent.children[t])})},PopupMenuContainerElement=function(t){this.element=t,this.body=t,this.children=new Array,this.element.data("popupElement",this)},PopupElement.count=0,PopupElement.dom=function(){this.body.appendTo("#popup-active-overlay");var t=this.element.attr("class"),e=t.match(/popup-style-[^'\s]+/);this.body.wrap('<div id="'+this.elementId+'-active" class="popup-element-wrapper'+(e?" "+e:"")+'">'),this.wrapper=this.body.parent(),this.wrapper.css("position","absolute"),this.body.wrap('<div class="popup-element-origin">'),this.origin=this.body.parent(),this.origin.css("position","absolute")},PopupElement.assignEffects=function(){var t=this.element.attr("class").match(/effect-([^\s]+)/)[1];this.animShow=new Function(Drupal.settings.popup.effects.show[t]),this.animHide=new Function(Drupal.settings.popup.effects.hide[t])},PopupElement.assignPositioning=function(){var t=this.element.attr("class").match(/origin-([^\s]+)/)[1];this.position=PopupElement.position[t]},PopupElement.assignExpansion=function(){var t=this.element.attr("class").match(/expand-([^\s]+)/)[1];PopupElement.expand[t].apply(this)},PopupElement.assignEvents=function(){this.element.hasClass("activate-hover")?PopupElement.hoverEvents.apply(this):PopupElement.clickEvents.apply(this);var t=this;this.element.bind("hide",function(){PopupElement.hide.apply(t)}).bind("show",function(){PopupElement.show.apply(t)})},PopupElement.applyAttributes=function(){if(this.body.attr("class")){var e=this.body.attr("class").match(/opacity-([^\s]+)/);e&&e[1]<1&&this.body.css({opacity:e[1],filter:"alpha(opacity="+e[1]+")"});var i=this.body.attr("class").match(/width-([^\s]+)/);i&&t(".inner",this.body).css("width",i[1]+"px")}},PopupElement.applyAJAX=function(){var e=this,i=function(i,n){e.body.unbind("showing",p);var o=t(".popup-close-button",n);o.length?(o.siblings().remove(),n.append(i)):n.html(i),Drupal.attachBehaviors(n)},p=function(){var p=e.body.find(".popup-ahah-placeholder"),n=p.parent(),o=t("a.ahah-path",p).attr("href");t.get(o,null,function(t){i(t,n)})};this.body.hasClass("ajax")&&this.body.bind("showing",p)},PopupElement.hide=function(){this.visible&&(this.body.trigger("hiding"),this.animHide(),this.title.removeClass("popup-title-active"),this.element.removeClass("popup-element-active"),this.visible=!1,this.body.queue("function(){ PopupElement.count--; }"),this.body.trigger("hidden"))},PopupElement.show=function(){this.visible||(this.body.css("z-index",++PopupElement.count),this.body.trigger("showing"),this.position(),this.animShow(),this.title.addClass("popup-title-active"),this.element.addClass("popup-element-active"),this.visible=!0,this.body.trigger("shown"))},PopupElement.clickEvents=function(){this.visible=!1;var t=this;this.title.click(function(){return 1==t.visible?PopupElement.hide.apply(t):PopupElement.show.apply(t),!1})},PopupElement.hoverEvents=function(){var t=this;if(!this.isRoot){var e=this.title.parents(".popup-element-body").data("popupElement");this.parent=e?e:this.title.parents(".popup-menu-flat").data("popupElement"),this.parent.children.push(this)}var i=function(){clearTimeout(t.hideTimeout),t.showTimeout&&clearTimeout(t.showTimeout),t.hideTimeout=setTimeout(function(){PopupElement.hide.apply(t)},Drupal.settings.popup.linger),t.isRoot||t.parent.body.trigger("mouseleave")};this.body.bind("mouseleave",i),this.title.bind("mouseleave",i);var p=function(){var e=t;for(clearTimeout(t.hideTimeout);e=e.parent;)clearTimeout(e.hideTimeout)};this.body.bind("mouseover",p),this.title.bind("mouseover",p);var n=function(){t.showTimeout=setTimeout(function(){if(!t.visible&&(PopupElement.show.apply(t),t.parent))for(var e in t.parent.children)t.parent.children[e]!=t&&PopupElement.hide.apply(t.parent.children[e])},Drupal.settings.popup.delay)};this.title.bind("mouseenter",n)},PopupElement.position={"top-left":function(){var t=this.title.offset();this.origin.css({top:t.top,left:t.left})},"top-right":function(){var t=this.title.offset();this.origin.css({top:t.top,left:t.left+this.title.outerWidth()})},"bottom-left":function(){var t=this.title.offset();this.origin.css({top:t.top+this.title.outerHeight(),left:t.left})},"bottom-right":function(){var t=this.title.offset();this.origin.css({top:t.top+this.title.outerHeight(),left:t.left+this.title.outerWidth()})}},PopupElement.expand={"top-left":function(){this.body.css({bottom:0,right:0})},"top-right":function(){this.body.css({bottom:0,left:0})},"bottom-left":function(){this.body.css({top:0,right:0})},"bottom-right":function(){this.body.css({top:0,left:0})}}}(jQuery);